<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Code to Any File Creator by CMD</title>
  <style>
    :root {
      --primary: linear-gradient(135deg, #6e8efb, #a777e3);
      --dark: #1e1e2e;
      --light: #f8f9fa;
      --gray: #d1d5db;
      --success: #4ade80;
      --warning: #f59e0b;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--primary);
      color: var(--dark);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      overflow: hidden;
      padding: 20px;
    }

    header {
      text-align: center;
      margin-bottom: 20px;
    }

    h1 {
      font-size: 1.8rem;
      color: var(--dark);
    }

    p {
      color: #6b7280;
      font-size: 0.95rem;
    }

    .form-group {
      margin-bottom: 16px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: var(--dark);
    }

    textarea, input[type="text"] {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--gray);
      border-radius: 8px;
      font-family: 'Consolas', monospace;
      font-size: 0.95rem;
      transition: border 0.3s;
    }

    textarea {
      min-height: 120px;
      resize: vertical;
    }

    textarea:focus, input:focus {
      outline: none;
      border-color: #6e8efb;
    }

    .output-container {
      position: relative;
      margin-top: 16px;
    }

    #output {
      background: var(--dark);
      color: var(--light);
      font-family: 'Consolas', monospace;
      padding: 14px;
      border-radius: 8px;
      font-size: 0.9rem;
      line-height: 1.4;
      white-space: pre-wrap;
      word-break: break-all;
      min-height: 80px;
      max-height: 400px;
      overflow-y: auto;
    }

    .copy-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #333;
      color: white;
      border: none;
      padding: 6px 10px;
      font-size: 0.8rem;
      border-radius: 6px;
      cursor: pointer;
      opacity: 0.9;
      transition: opacity 0.3s, background 0.3s;
      z-index: 10;
    }

    .copy-btn:hover {
      opacity: 1;
      background: #555;
    }

    .btn-group {
      display: flex;
      gap: 10px;
      margin-top: 16px;
      flex-wrap: wrap;
    }

    button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      background: var(--primary);
      color: white;
      cursor: pointer;
      font-size: 0.95rem;
      flex: 1;
      min-width: 100px;
      transition: transform 0.2s, opacity 0.2s;
    }

    button:hover {
      opacity: 0.9;
    }

    button:active {
      transform: scale(0.98);
    }

    .clear-btn {
      background: #ef4444;
    }

    .warning-box {
      background: #fef3cd;
      border: 1px solid var(--warning);
      color: #856404;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 16px;
      font-size: 0.9rem;
      display: none;
    }

    .warning-box.show {
      display: block;
    }

    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--success);
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 0.9rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .toast.show {
      opacity: 1;
    }

    .tips {
      background: #f0f9ff;
      border: 1px solid #0ea5e9;
      color: #0c4a6e;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 16px;
      font-size: 0.9rem;
    }

    .tips h4 {
      margin-bottom: 8px;
      color: #0c4a6e;
    }

    .tips ul {
      margin-left: 20px;
    }

    .tips li {
      margin-bottom: 4px;
    }

    @media (max-width: 600px) {
      .btn-group {
        flex-direction: column;
      }
      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <header>
      <h1>üöÄ Code to CMD File Creator</h1>
      <p>Smart CMD generator with proper escaping for Python, JS, and any code.</p>
    </header>

    <div class="tips">
      <h4>‚ú® Smart Features:</h4>
      <ul>
        <li>Auto-detects and fixes comparison operators (>, <, >=, <=, ==, !=)</li>
        <li>Properly escapes special characters (&, |, %, ^)</li>
        <li>Handles environment variables (%VAR%)</li>
        <li>Works with any programming language</li>
      </ul>
    </div>

    <div class="warning-box" id="warningBox">
      <strong>‚ö†Ô∏è Potential Issues Detected:</strong>
      <div id="warningText"></div>
    </div>

    <div class="form-group">
      <label for="code">Code Snippet</label>
      <textarea id="code" placeholder="Paste your Python, JS, CMD, or any code here..."></textarea>
    </div>

    <div class="form-group">
      <label for="path">Full File Path (e.g., C:\scripts\app.py)</label>
      <input type="text" id="path" placeholder="C:\folder\file.ext" />
    </div>

    <div class="form-group">
      <label for="output">Generated CMD Command</label>
      <div class="output-container">
        <button class="copy-btn" onclick="copyCommand()">üìã Copy</button>
        <div id="output">CMD command will appear here...</div>
      </div>
    </div>

    <div class="btn-group">
      <button onclick="generateCommand()">üîß Generate CMD Command</button>
      <button class="clear-btn" onclick="clearAll()">üóëÔ∏è Clear All</button>
    </div>
  </div>

  <div id="toast" class="toast">Copied to clipboard!</div>

  <script>
    // Auto-generate on input
    document.getElementById('code').addEventListener('input', generateCommand);
    document.getElementById('path').addEventListener('input', generateCommand);

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      // Ctrl + Enter ‚Üí Generate
      if (e.ctrlKey && e.key === 'Enter') {
        e.preventDefault();
        generateCommand();
      }
    });

    // Allow Ctrl+C in output
    document.getElementById('output').addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.key === 'c') {
        copyCommand();
        e.preventDefault();
      }
    }, true);

    // Make output selectable
    const outputEl = document.getElementById('output');
    outputEl.setAttribute('contenteditable', 'false');
    outputEl.style.userSelect = 'text';

    // Load example on page load
    window.onload = function() {
      document.getElementById('code').value = `import re

# === SETTINGS ===
ffmpegready_file = r"C:\\YouTube\\ffmpegready.txt"
output_bat = r"C:\\YouTube\\make_video.bat"
output_video = r"C:\\Users\\admin\\Downloads\\good.mp4"
audio_file = r"C:\\YouTube\\audio.mp3"

fps = 30  # frames per second
zoom_speed = "0.0015"  # how fast zoom increases
fade_duration = 0.5    # seconds (crossfade overlap)

# === READ INPUT FILE ===
with open(ffmpegready_file, "r") as f:
    lines = f.readlines()

files = []
durations = []
for i in range(0, len(lines), 2):
    img_line = lines[i].strip()
    dur_line = lines[i+1].strip() if i+1 < len(lines) else None

    match = re.match(r"file '(.+)'", img_line)
    if not match:
        continue
    img_file = match.group(1)

    dur = None
    if dur_line and dur_line.startswith("duration"):
        dur = float(dur_line.split()[1])

    files.append(img_file)
    durations.append(dur)

# === BUILD FFMPEG COMMAND ===
inputs = []
filters = []
xfade_chains = []

# Input section
for i, (img, dur) in enumerate(zip(files, durations)):
    if dur is None:
        dur = durations[-2]  # fallback for last image

    inputs.append(f'-loop 1 -t {dur:.2f} -i "{img}"')

    # frames = duration * fps
    frames = int(dur * fps)
    filters.append(
        f'[{i}:v]zoompan=z=\\'min(zoom+{zoom_speed},1.5)\\':d={frames}:s=1280x720,format=yuv420p[v{i}]'
    )

# Xfade chain
for i in range(len(files)-1):
    if i == 0:
        left = f"[v0]"
    else:
        left = f"[xf{i-1}]"

    right = f"[v{i+1}]"
    out = f"[xf{i}]"

    offset = sum(durations[:i+1]) - fade_duration
    xfade_chains.append(
        f'{left}{right}xfade=transition=fade:duration={fade_duration}:offset={offset:.2f}{out}'
    )

# Fix: proper inline if/else expression
if len(files) > 1:
    final_map = f"[xf{len(files)-2}]"
else:
    final_map = "[v0]"

# Build command using single string (avoids multi-line concatenation issues)
command_parts = [
    '@echo off',
    'ffmpeg ^',
    ' ^\\n'.join(inputs) + f' ^\\n-i "{audio_file}" ^',
    '-filter_complex "',
    ';\\n'.join(filters) + ';',
    ';\\n'.join(xfade_chains) + '"',
    f'-map "{final_map}" -map {len(files)}:a -shortest -pix_fmt yuv420p -c:v libx264 "{output_video}"',
    'exit'
]

command = '\\n'.join(command_parts)

# === SAVE BAT FILE ===
with open(output_bat, "w") as f:
    f.write(command)

print(f"‚úÖ Batch file created: {output_bat}")`;

      document.getElementById('path').value = 'C:\\YouTube\\ffmpeg_command.py';
      generateCommand();
    };

    function generateCommand() {
      const code = document.getElementById('code').value;
      const rawPath = document.getElementById('path').value.trim();
      const outputEl = document.getElementById('output');
      const warningBox = document.getElementById('warningBox');
      const warningText = document.getElementById('warningText');

      if (!code || !rawPath) {
        outputEl.textContent = 'Enter code and file path to generate command...';
        warningBox.classList.remove('show');
        return;
      }

      // Normalize path: ensure backslashes are correct
      const path = rawPath.replace(/\\/g, '\\\\');

      const lines = code.split('\n');
      const parts = [];
      let warnings = [];

      // Advanced line processing with context awareness
      let inMultilineString = false;
      let stringDelimiter = '';
      let openParenCount = 0;
      let openBracketCount = 0;
      let openBraceCount = 0;

      lines.forEach((line, index) => {
        let cmdPart;

        // Handle empty lines
        if (line.trim() === '') {
          cmdPart = 'echo.';
        } else {
          // ADVANCED ESCAPING LOGIC WITH CONTEXT AWARENESS
          let escaped = line;

          // Track multiline contexts (parentheses, brackets, braces)
          const trimmed = line.trim();
          openParenCount += (trimmed.match(/\(/g) || []).length - (trimmed.match(/\)/g) || []).length;
          openBracketCount += (trimmed.match(/\[/g) || []).length - (trimmed.match(/\]/g) || []).length;
          openBraceCount += (trimmed.match(/\{/g) || []).length - (trimmed.match(/\}/g) || []).length;

          // Check if we're in a multiline string
          const quotes = trimmed.match(/['"]/g) || [];
          quotes.forEach(quote => {
            if (!inMultilineString) {
              inMultilineString = true;
              stringDelimiter = quote;
            } else if (quote === stringDelimiter) {
              inMultilineString = false;
              stringDelimiter = '';
            }
          });

          // Step 1: Protect all quoted strings temporarily
          const stringPlaceholders = [];
          let stringIndex = 0;
          
          // Handle both single and double quotes, including multiline f-strings
          escaped = escaped.replace(/(f?r?["'])((?:\\.|(?!\1).)*)\1/g, function(match) {
            const placeholder = `__STRING_${stringIndex}__`;
            stringPlaceholders[stringIndex] = match;
            stringIndex++;
            return placeholder;
          });

          // Step 2: Handle special CMD redirection characters that break parsing
          // These are the main culprits that cause issues
          escaped = escaped
            .replace(/\s+>>\s+/g, ' __APPEND__ ')  // Protect >> redirection
            .replace(/\s+>\s+/g, ' __REDIRECT__ ') // Protect > redirection
            .replace(/\s+\|\s+/g, ' __PIPE__ ');   // Protect | pipe

          // Step 3: Smart operator escaping - context-aware
          if (!inMultilineString && openParenCount >= 0 && openBracketCount >= 0 && openBraceCount >= 0) {
            // Only escape operators when we're in normal code context
            const operatorMap = {
              '>=': '^>^=',
              '<=': '^<^=', 
              '==': '^=^=',
              '!=': '^!^=',
              '<<': '^<^<',
              '>>': '^>^>',
              '<': '^<',
              '>': '^>'
            };

            // Apply operator replacements (longer operators first)
            Object.keys(operatorMap)
              .sort((a, b) => b.length - a.length)
              .forEach(op => {
                // Only replace if not already protected
                if (!escaped.includes('__APPEND__') || op !== '>>') {
                  if (!escaped.includes('__REDIRECT__') || op !== '>') {
                    const regex = new RegExp('\\b' + escapeRegExp(op) + '\\b', 'g');
                    escaped = escaped.replace(regex, operatorMap[op]);
                  }
                }
              });
          }

          // Step 4: Restore redirection operators
          escaped = escaped
            .replace(/__APPEND__/g, '^>^>')
            .replace(/__REDIRECT__/g, '^>')
            .replace(/__PIPE__/g, '^|');

          // Step 5: Escape other CMD special characters (but not inside strings)
          escaped = escaped
            .replace(/&(?!__)/g, '^&')  // Don't escape & in our placeholders
            .replace(/\^(?![&|<>=!])/g, '^^')  // Only escape ^ if not already escaping
            .replace(/%([a-zA-Z0-9_]+)%/g, '%%$1%%'); // Environment variables

          // Step 6: Restore original strings
          stringPlaceholders.forEach((original, index) => {
            escaped = escaped.replace(`__STRING_${index}__`, original);
          });

          // Detect potential issues with better context
          if (line.includes('>>') && !line.includes('"') && !line.includes("'")) {
            warnings.push(`Line ${index + 1}: Contains '>>' operator - properly escaped as '^>^>'`);
          }
          if (line.includes('<%') || line.includes('%>')) {
            warnings.push(`Line ${index + 1}: Contains template-like syntax - may need manual review`);
          }
          if (trimmed.startsWith('+') && (openParenCount > 0 || openBracketCount > 0)) {
            warnings.push(`Line ${index + 1}: String continuation line detected - handled properly`);
          }

          // Build echo command
          cmdPart = `echo ${escaped}`;
        }

        // First line: use >, rest: >>
        cmdPart += index === 0 ? ` > "${path}"` : ` >> "${path}"`;
        parts.push(cmdPart);
      });

      // Show warnings if any
      if (warnings.length > 0) {
        warningText.innerHTML = warnings.join('<br>');
        warningBox.classList.add('show');
      } else {
        warningBox.classList.remove('show');
      }

      // Join all with ` & ` for sequential execution
      const finalCommand = parts.join(' & ');
      outputEl.textContent = finalCommand;
    }

    // Helper function to escape regex special characters
    function escapeRegExp(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    function copyCommand() {
      const outputEl = document.getElementById('output');
      const text = outputEl.textContent;

      if (!text || text.includes('Enter code')) return;

      // Use modern Clipboard API if available
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => {
          showToast('Copied to clipboard! üìã');
        }).catch(err => {
          fallbackCopy(text);
        });
      } else {
        fallbackCopy(text);
      }
    }

    function fallbackCopy(text) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.opacity = '0';
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand('copy');
      document.body.removeChild(textarea);
      showToast('Copied to clipboard! üìã');
    }

    function showToast(message = 'Copied to clipboard!') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 2000);
    }

    function clearAll() {
      document.getElementById('code').value = '';
      document.getElementById('path').value = '';
      document.getElementById('output').textContent = 'CMD command will appear here...';
      document.getElementById('warningBox').classList.remove('show');
      generateCommand();
    }
  </script>

</body>
</html>
